<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤§å¸çš„é»˜å¥‘åº¦é—®ç­”ğŸ¥µ</title>
    <style>
        :root {
            --google-blue: #4285f4;
            --google-red: #ea4335;
            --google-yellow: #fbbc05;
            --google-green: #34a853;
            --gray-bg: #f8f9fa;
        }

        body {
            background-color: var(--gray-bg);
            color: #202124;
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            margin: 0; padding-bottom: 50px;
            display: flex; flex-direction: column; align-items: center; min-height: 100vh;
        }

        .rainbow-bar {
            height: 5px; width: 100%;
            background: linear-gradient(to right, var(--google-blue) 25%, var(--google-red) 25% 50%, var(--google-yellow) 50% 75%, var(--google-green) 75%);
            position: fixed; top: 0; left: 0; z-index: 100;
        }

        .container {
            max-width: 650px; width: 92%; background: white;
            margin-top: 60px; padding: 35px; border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1), 0 10px 20px rgba(0,0,0,0.05);
        }

        h1 { font-size: 24px; font-weight: 400; text-align: center; margin-bottom: 30px; color: #3c4043; }

        .input-field {
            border: 1px solid #dadce0; border-radius: 8px; padding: 14px 18px;
            font-size: 16px; width: 100%; box-sizing: border-box; margin-bottom: 20px; outline: none;
        }
        .input-field:focus { border: 2px solid var(--google-blue); }

        .btn-group { display: flex; gap: 15px; justify-content: center; flex-wrap: wrap; }

        .btn {
            border: none; padding: 12px 28px; font-size: 15px; border-radius: 24px;
            cursor: pointer; transition: 0.3s; font-weight: 500;
        }
        .btn-blue { background: var(--google-blue); color: white; }
        .btn-outline { background: white; border: 1px solid #dadce0; color: #5f6368; }
        .btn:hover { box-shadow: 0 4px 8px rgba(0,0,0,0.1); transform: translateY(-1px); }
        .btn:disabled { background: #ccc; cursor: not-allowed; }

        .question-card {
            border: 1px solid #dadce0; border-radius: 8px; padding: 22px; margin-bottom: 18px;
        }
        .question-text { font-size: 17px; font-weight: 500; margin-bottom: 15px; color: #202124; }
        .options label {
            display: block; margin: 12px 0; cursor: pointer; padding: 10px; border-radius: 6px; border: 1px solid transparent; transition: 0.2s;
        }
        .options label:hover { background: #f8f9fa; border-color: #eee; }
        .options input { margin-right: 12px; transform: scale(1.2); }

        #result { display: none; text-align: center; }
        .score-circle {
            width: 140px; height: 140px; border: 12px solid #eee; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 32px; font-weight: bold; margin: 30px auto; transition: 0.8s;
        }

        .email-box { margin-top: 30px; padding: 20px; background: #f1f3f4; border-radius: 8px; }
        .rank-section { margin-top: 30px; padding: 20px; background: #f1f3f4; border-radius: 8px; }
        .hidden { display: none; }
        
        .rank-btn-container {
            text-align: center;
            margin-top: 20px;
        }
    </style>
</head>
<body>

<div class="rainbow-bar"></div>

<div class="container">
    <h1 id="top-title"> å¤§å¸çš„é»˜å¥‘åº¦é—®ç­”ğŸ¥µ </h1>

    <div id="auth-section">
        <input type="text" id="user-id" class="input-field" placeholder="è¾“å…¥ ID ä»¥å¼€å§‹..." onkeydown="if(event.key==='Enter')startQuiz('full')">
        <div class="btn-group">
            <button class="btn btn-outline" onclick="startQuiz('brief')">ç®€ç•¥ç‰ˆ (20é¢˜)</button>
            <button class="btn btn-blue" onclick="startQuiz('full')">å®Œæ•´ç‰ˆ (40é¢˜)</button>
        </div>
        <div class="rank-btn-container">
            <button class="btn btn-outline" onclick="showRankingDirectly()">æŸ¥çœ‹æ’è¡Œæ¦œ</button>
        </div>
    </div>

    <div id="quiz-section" class="hidden">
        <form id="quiz-form">
            <div id="questions-container"></div>
            <button type="button" class="btn btn-blue" style="width:100%; margin-top:20px;" onclick="calculateScore()">æäº¤æˆ‘çš„ç­”æ¡ˆ</button>
        </form>
    </div>

    <div id="result">
        <h2 id="result-title"> ä½ è·Ÿå¤§å¸çš„ç›¸ä¼¼åº¦å¤§æ¦‚æœ‰è¿™ä¹ˆå¤š... </h2>
        <div class="score-circle" id="score-display">0%</div>
        <p id="result-text" style="font-size: 18px; color: #3c4043; line-height: 1.6; padding: 0 10px;"></p>
        
        <div class="rank-section">
            <h3>ğŸ† å®æ—¶åˆ†æ•°æ’è¡Œæ¦œ</h3>
            <input 
                type="text" 
                id="rank-user-id" 
                placeholder="è¾“å…¥ä½ çš„IDï¼Œå°†åˆ†æ•°ä¸Šæ¦œ"
                style="padding: 8px; width: 200px; margin: 10px 0; border: 1px solid #ccc; border-radius: 4px;"
            >
            <button id="submit-rank-btn" class="btn btn-blue" style="margin-bottom: 15px;" onclick="submitToRanking()">åˆ†æ•°ä¸Šæ¦œ</button>
            <div id="rank_list">æ­£åœ¨åŠ è½½æ’è¡Œæ¦œ...</div>
        </div>

        <div class="email-box">
            <p style="font-size: 14px; margin-bottom: 10px;">è¦å‘é€å›ç­”è®°å½•åˆ°è‡ªå·±çš„é‚®ç®±å—ï¼Ÿ</p>
            <input type="email" id="user-email" class="input-field" placeholder="è¾“å…¥ä½ çš„é‚®ç®±...">
            <button class="btn btn-blue" onclick="alert('éª—ä½ çš„å…¶å®æˆ‘æ²¡é…æœåŠ¡å™¨')">å‘é€ç»“æœ</button>
        </div>
        
        <button class="btn btn-outline" style="margin-top: 25px;" onclick="location.reload()">é‡æ–°æµ‹è¯•</button>
    </div>
</div>

<script> 
    // æ§åˆ¶å°è¾“å…¥yoursï¼ˆï¼‰æŸ¥çœ‹æˆ‘çš„ç­”æ¡ˆ
    const API_BASE = "https://quiz-backend-1-lrmy.onrender.com";

    const qData = [
        { id: "q1", q: "å¥¥åˆ©å¥¥è¿˜æ˜¯è¶£å¤šå¤šï¼Ÿ", opts: ["å¥¥åˆ©å¥¥", "è¶£å¤šå¤š"], a: "6Laj5aSa5aSa" },
        { id: "q2", q: "ç©¿ä¸‰è§’è¿˜æ˜¯å¹³è§’ï¼Ÿ", opts: ["ä¸‰è§’", "å¹³è§’"], a: "5LiJ6KeS" },
        { id: "q3", q: "Gemini è¿˜æ˜¯ DeepSeekï¼Ÿ", opts: ["Gemini", "DeepSeek"], a: "R2VtaW5p" },
        { id: "q4", q: "å–œæ¬¢çŒ«è¿˜æ˜¯ç‹—ï¼Ÿ", opts: ["çŒ«", "ç‹—"], a: "54uX" },
        { id: "q5", q: "å†¬å¤©è¿˜æ˜¯å¤å¤©ï¼Ÿ", opts: ["å†¬å¤©", "å¤å¤©"], a: "5aSP5aSp" },
        { id: "q6", q: "è–¯æ¡è˜¸ç•ªèŒ„é…±å—ï¼Ÿ", opts: ["ä¼š", "ä¸ä¼š"], a: "5Lya" }, 
        { id: "q7", q: "å‡ºé—¨å¸¦ä¸å¸¦å……ç”µå®ï¼Ÿ", opts: ["å¸¦", "ä¸å¸¦"], a: "5bim" },
        { id: "q8", q: "èƒŒåŒ…é‡Œä¼šä¸ä¼šå¤‡æœ‰è¯•çº¸ï¼Ÿ", opts: ["ä¼š", "ä¸ä¼š"], a: "5Lya" },
        { id: "q9", q: "æ—©ç¡æ—©èµ·è¿˜æ˜¯ç»å¸¸ç†¬å¤œï¼Ÿ", opts: ["æ—©ç¡æ—©èµ·", "ç»å¸¸ç†¬å¤œ"], a: "5pep552h5pep6LW3" },
        { id: "q10", q: "æ— çº¸åŒ–å­¦ä¹ ï¼Ÿ", opts: ["æ˜¯", "å¦"], a: "5ZCm" },
        { id: "q11", q: "ç§’å›æ¶ˆæ¯è¿˜æ˜¯å‡†å¤‡å¥½å†å›ï¼Ÿ", opts: ["ç§’å›", "å‡†å¤‡å¥½"], a: "5YeG5aSH5aW9" },
        { id: "q12", q: "å–œæ¬¢çœ‹æ—¥å‡ºè¿˜æ˜¯æ—¥è½ï¼Ÿ", opts: ["æ—¥å‡º", "æ—¥è½"], a: "5pel5Ye6" },
        { id: "q13", q: "Lady Gaga è¿˜æ˜¯ Taylor Swiftï¼Ÿ", opts: ["Lady Gaga", "Taylor Swift"], a: "TGFkeSBHYWdh" },
        { id: "q14", q: "åº“è¿ªè¿˜æ˜¯ç‘å¹¸ï¼Ÿ", opts: ["åº“è¿ª", "ç‘å¹¸"], a: "5bqT6L+q" },
        { id: "q15", q: "åƒä¸åƒé¦™èœï¼Ÿ", opts: ["åƒ", "ä¸åƒ"], a: "5ZCD" },
        { id: "q16", q: "å–œæ¬¢æ‹é£æ™¯è¿˜æ˜¯äººåƒï¼Ÿ", opts: ["é£æ™¯", "äººåƒ"], a: "5Lq65YOP" },
        { id: "q17", q: "æ—…è¡Œæå‰è®¡åˆ’è¿˜æ˜¯éšæ—¶å‡ºå‘ï¼Ÿ", opts: ["æå‰è®¡åˆ’", "éšæ—¶å‡ºå‘"], a: "5o+Q5YmN6K6h5YiS" },
        { id: "q18", q: "æ‰‹æœºå¸¦å£³å—ï¼Ÿ", opts: ["å¸¦", "ä¸å¸¦"], a: "5bim" },
        { id: "q19", q: "æ‰‹å†²å’–å•¡è¿˜æ˜¯æ„å¼ï¼Ÿ", opts: ["æ‰‹å†²", "æ„å¼"], a: "5oSP5byP" },
        { id: "q20", q: "EDM è¿˜æ˜¯ Jazzï¼Ÿ", opts: ["EDM", "Jazz"], a: "RURN" },
        { id: "q21", q: "æŠ’æƒ…æµè¡Œè¿˜æ˜¯æ‘‡æ»šï¼Ÿ", opts: ["æµè¡Œ", "æ‘‡æ»š"], a: "5rWB6KGM" },
        { id: "q22", q: "è€å…‹è¿˜æ˜¯å®‰å¾·ç›ï¼Ÿ", opts: ["è€å…‹", "å®‰å¾·ç›"], a: "5a6J5b63546b" },
        { id: "q23", q: "ç ´äº§å§å¦¹orç»å‘½æ¯’å¸ˆï¼Ÿ", opts: ["ç ´äº§å§å¦¹", "ç»å‘½æ¯’å¸ˆ"], a: "56C05Lqn5aeQ5aa5" }, 
        { id: "q24", q: "é»‘è‰²è¿˜æ˜¯ç™½è‰²ï¼Ÿ", opts: ["é»‘è‰²", "ç™½è‰²"], a: "6buR6Imy" }, 
        { id: "q25", q: "è°ˆè¿‡å¥³æœ‹å‹å—ï¼Ÿ", opts: ["æœ‰", "å¦"], a: "5ZCm" },
        { id: "q26", q: "æ—…è¡Œæ›´åœ¨æ„åƒè¿˜æ˜¯ä½ï¼Ÿ", opts: ["åƒ", "ä½"], a: "5ZCD" },
        { id: "q27", q: "é™ˆå¥•è¿…è¿˜æ˜¯å«å…°ï¼Ÿ", opts: ["é™ˆå¥•è¿…", "å«å…°"], a: "5Y2r5YWw" },
        { id: "q28", q: "ä»¥åè¿˜æœ‰å¯èƒ½å…»å® ç‰©å—ï¼Ÿ", opts: ["ä¼š", "ä¸ä¼š"], a: "5Lya" },
        { id: "q29", q: "ç›¸ä¿¡ç¥ç§˜å­¦å—ï¼Ÿ", opts: ["ç›¸ä¿¡", "ä¸ç›¸ä¿¡"], a: "55u45L+h" },
        { id: "q30", q: "ç›¸ä¿¡é£æ°´å­¦å—ï¼Ÿ", opts: ["ç›¸ä¿¡", "ä¸ç›¸ä¿¡"], a: "55u45L+h" },
        { id: "q31", q: "ä¼šä»¥äº¤å‹ä¸ºä¸»è¦ç›®çš„è€Œæ—…è¡Œå—ï¼Ÿ", opts: ["ä¼š", "ä¸ä¼š"], a: "5Lya" },
        { id: "q32", q: "æ—…è¡Œæ›´å–œæ¬¢Soloè¿˜æ˜¯ç»„é˜Ÿï¼Ÿ", opts: ["Solo", "ç»„é˜Ÿ"], a: "U29sbw==" },
        { id: "q33", q: "èµ·é£æ—¶æ›´å€¾å‘ X è¿˜æ˜¯ç”µæŠ¥ï¼Ÿ", opts: ["X", "ç”µæŠ¥"], a: "WA==" },
        { id: "q34", q: "æ”¯æŒè€ƒç ”è¿˜æ˜¯è€ƒå…¬ï¼Ÿ", opts: ["è€ƒç ”", "è€ƒå…¬"], a: "6ICD56CU" },
        { id: "q35", q: "æ”¯æŒåŠ¨ä¿ï¼Ÿ", opts: ["æ”¯æŒ", "ä¸æ”¯æŒ"], a: "5pSv5oyB" },
        { id: "q36", q: "æ‹ç‰©ç™–ï¼Ÿ", opts: ["æœ‰", "æ²¡æœ‰"], a: "5pyJ" },
        { id: "q37", q: "ä½ è§‰å¾—30å²åœ¨äººç”Ÿä¸­ç®—æ—©å—ï¼Ÿ", opts: ["æ—©", "ä¸æ—©"], a: "5pep" },
        { id: "q38", q: "ä½ å·²ç»æµç‹¬ç«‹äº†å—ï¼Ÿ", opts: ["å·²ç‹¬ç«‹", "æš‚æœª"], a: "5pqC5pyq" },
        { id: "q39", q: "ä½ å±äºé«˜æ•æ„Ÿäººç¾¤å—ï¼Ÿ", opts: ["æ˜¯", "å¦"], a: "5piv" },
        { id: "q40", q: "å¯¹ç¤¾ä¼šå­¦ï¼Œå¿ƒç†å­¦æˆ–è¯­è¨€å­¦æ„Ÿå…´è¶£å—ï¼Ÿ", opts: ["æ˜¯", "å¦"], a: "5piv" }
    ];

    let currentSet = [];
    let finalScore = 0; 

    window.onload = function() {
        const savedUserId = localStorage.getItem('quiz_user_id');
        if (savedUserId) {
            document.getElementById('user-id').value = savedUserId;
        }
        loadRanking();
    };

    function safeAtob(str) {
        try {
            return decodeURIComponent(escape(window.atob(str))).trim(); 
        } catch (e) {
            return window.atob(str).trim();
        }
    }

    function startQuiz(mode) {
        const id = document.getElementById('user-id').value;
        if (!id.trim()) { 
            alert("å¿…é¡»è¾“å…¥ ID æ‰èƒ½å¼€å§‹å“¦"); 
            return; 
        }
        localStorage.setItem('quiz_user_id', id);
        
        document.getElementById('top-title').innerText = "åŠ è½½ä¸­...";
        document.getElementById('auth-section').classList.add('hidden');
        document.getElementById('quiz-section').classList.remove('hidden');

        let shuffled = [...qData].sort(() => Math.random() - 0.5);
        currentSet = mode === 'brief' ? shuffled.slice(0, 20) : shuffled;
        renderQuestions();
    }

    function renderQuestions() {
        const container = document.getElementById('questions-container');
        container.innerHTML = "";
        currentSet.forEach((item, i) => {
            const card = document.createElement('div');
            card.className = 'question-card';
            card.innerHTML = `
                <div class="question-text">${i+1}. ${item.q}</div>
                <div class="options">
                    ${item.opts.map(o => `<label><input type="radio" name="${item.id}" value="${o.trim()}"> ${o}</label>`).join('')}
                </div>
            `;
            container.appendChild(card);
        });
        window.scrollTo(0, 0);
        document.getElementById('top-title').innerText = "å¤§å¸çš„é»˜å¥‘åº¦é—®ç­”ğŸ¥µ";
    }

    function calculateScore() {
        let scoreCount = 0;
        let answeredCount = 0;
        
        currentSet.forEach(item => {
            const sel = document.querySelector(`input[name="${item.id}"]:checked`);
            if (sel) {
                answeredCount++;
                if (sel.value === safeAtob(item.a)) {
                    scoreCount++;
                }
            }
        });

        if (answeredCount < currentSet.length) { 
            alert(`è¿˜æœ‰ ${currentSet.length - answeredCount} é“é¢˜æ²¡å†™å®Œï¼Œä¸å‡†è·‘ï¼`); 
            return; 
        }

        finalScore = Math.round((scoreCount / currentSet.length) * 100);
        showResult(finalScore);
    }

    function showResult(s) {
        document.getElementById('quiz-section').classList.add('hidden');
        document.getElementById('result').style.display = 'block';
        
        const circle = document.getElementById('score-display');
        const text = document.getElementById('result-text');
        const userId = document.getElementById('user-id').value;
        
        // å…³é”®ä¿®æ­£ï¼šè‡ªåŠ¨åŒæ­¥ ID åˆ°æ’è¡Œæ¦œè¾“å…¥æ¡†
        document.getElementById('rank-user-id').value = userId;
        
        circle.innerText = s + "%";
        
        if (s >= 80) {
            circle.style.borderColor = "var(--google-blue)"; circle.style.color = "var(--google-blue)";
            text.innerText = `${userId}ï¼Œæˆ‘ä»¬æ˜¯å¤©é€ åœ°è®¾çš„å§å¦¹ã€‚`;
        } else if (s >= 60) {
            circle.style.borderColor = "var(--google-green)"; circle.style.color = "var(--google-green)";
            text.innerText = `${userId}ï¼Œæˆ–è®¸æˆ‘æœ‰è·Ÿä½ èŠè¿‡æˆ‘çš„æ€§ç™–å¥½ã€‚å½“ç„¶ï¼Œä½ ç°åœ¨ä¹Ÿèƒ½é—®ã€‚`;
        } else if (s >= 35) {
            circle.style.borderColor = "var(--google-yellow)"; circle.style.color = "var(--google-yellow)";
            text.innerText = `${userId}ï¼Œæˆ‘ä»¬å¯èƒ½æœ‰äº›ä¸åŒçˆ±å¥½ã€‚å¦‚æœä½ æœ‰å…´è¶£ï¼Œæˆ‘ä»¬å¯ä»¥èŠèŠã€‚`;
        } else {
            circle.style.borderColor = "var(--google-red)"; circle.style.color = "var(--google-red)";
            text.innerText = `${userId}ï¼Œä½ æœ‰å¾ˆå¤šè§è§£ä¸æˆ‘ä¸å°½ç›¸åŒã€‚è¿™å¾ˆæœ‰æ„æ€ã€‚`;
        }

        loadRanking();
    }

    function showRankingDirectly() {
        document.getElementById('auth-section').classList.add('hidden');
        document.getElementById('result').style.display = 'block';
        document.getElementById('result-title').innerText = "å®æ—¶åˆ†æ•°æ’è¡Œæ¦œ";
        document.getElementById('score-display').innerText = "ğŸ†";
        document.getElementById('score-display').style.borderColor = "var(--google-yellow)";
        document.getElementById('score-display').style.color = "var(--google-yellow)";
        document.getElementById('result-text').innerText = "come on";
        loadRanking();
    }

    function submitToRanking() {
        const rankUserId = document.getElementById('rank-user-id').value;
        const btn = document.getElementById('submit-rank-btn');

        if (!rankUserId) {
            alert("è¯·è¾“å…¥IDå†ä¸Šæ¦œï¼");
            return;
        }

        btn.disabled = true;
        btn.innerText = "æäº¤ä¸­...";

        fetch(`${API_BASE}/submit`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ user_id: rankUserId, score: finalScore })
        }).then(response => {
            if (!response.ok) throw new Error(`HTTPé”™è¯¯ï¼š${response.status}`);
            return response.json();
        }).then(data => {
            if (data.success) {
                alert("åˆ†æ•°ä¸Šæ¦œæˆåŠŸï¼");
                loadRanking();
            } else {
                alert("åˆ†æ•°ä¸Šæ¦œå¤±è´¥ï¼š" + (data.error || "æœªçŸ¥é”™è¯¯"));
            }
        }).catch(err => {
            console.error("æ’è¡Œæ¦œæäº¤å¤±è´¥ï¼š", err);
            alert("åˆ†æ•°ä¸Šæ¦œå¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–ç¨åå†è¯•ï½");
        }).finally(() => {
            btn.disabled = false;
            btn.innerText = "åˆ†æ•°ä¸Šæ¦œ";
        });
    }

    function loadRanking() {
        fetch(`${API_BASE}/ranking`)
            .then(res => {
                if (!res.ok) throw new Error(`æ¥å£é”™è¯¯ï¼š${res.status}`);
                return res.json();
            })
            .then(data => {
                let html = '';
                if (!Array.isArray(data) || data.length === 0) {
                    html = "<p>æš‚æ— ä¸Šæ¦œåˆ†æ•°ï¼Œå¿«æ¥æˆä¸ºç¬¬ä¸€ä¸ªå§ï¼</p>";
                } else {
                    data.forEach((item, i) => {
                        html += `<p style="margin: 8px 0; border-bottom: 1px dashed #ddd; padding-bottom: 4px;">
                            <strong>${i+1}.</strong> ${item.user_id} â€” <span style="color:var(--google-blue)">${item.score}åˆ†</span>
                        </p>`;
                    });
                }
                document.getElementById('rank_list').innerHTML = html;
            }).catch(err => {
                console.error("æ’è¡Œæ¦œåŠ è½½å¤±è´¥ï¼š", err);
                document.getElementById('rank_list').innerHTML = `<p style="color:red">åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢ï½</p>`;
            });
    }

    window.yours = function() {
        if (currentSet.length === 0) return "âŒ å°šæœªå¼€å§‹";
        currentSet.forEach(item => {
            const correctVal = safeAtob(item.a);
            const radios = document.querySelectorAll(`input[name="${item.id}"]`);
            radios.forEach(r => {
                if (r.value.trim() === correctVal) r.checked = true;
            });
        });
        alert("ğŸ¥µ ä»¥ä¸‹æ˜¯æˆ‘çš„ç­”æ¡ˆã€‚");
        return "âœ… Done";
    };
</script>
</body>
</html>

